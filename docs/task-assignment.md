# 任务分解

## 系统总体架构

![architecture](images/architecture.png)

### 业务组件

#### 产品管理服务 fund-service

产品管理服务提供系统中各类基础信息的管理。

需要完成的工作：

* 各类基础信息数据的管理与查询

#### 投资服务 invest-service

投资服务主要用于管理投资指令的信息。

投资服务包含一系列具体的投资服务实现，它们以子模块的形式存在。投资服务的接口，需要派发到各个子模块中做具体实现。不同的子模块对于同一个接口的实现可能是不同的。

需要完成的工作：

* 总体接口实现：
  * 子模块的管理和指令派发。
* 各子模块的接口实现：
  * 指令草稿的管理
  * 提交、修改、撤销指令
  * 设置指令下达原因/备注/紧急程度
  * 查询指令
  * 委托分配计划管理
  * 风险试算

#### 交易服务 trade-service

交易服务主要用于管理委托。

交易服务包含一系列具体的交易服务实现，它们以子模块的形式存在。交易服务的接口，针对具体的交易服务，需要派发到各个子模块中做具体实现。不同的子模块对于同一个接口的实现可能是不同的。

需要完成的工作：

* 总体接口实现：
  * 子模块的管理和指令派发。
  * 查询指定投资服务对应的可用交易服务
* 各子模块的接口实现：
  * 返回指定投资指令对应的委托记录
  * 发起委托请求
  * 发起撤单请求
  * 返回交易参数
  * 计算相关指标
  * 返回指定交易服务的交易日/交易日历信息
  * 查询指定服务相关指标信息（此接口不对外公开）
  * 盘后清算

#### 资金持仓服务 inventory-service

资金持仓服务主要用于资金和持仓的计算。

资金和持仓在一次计算中需要事务性处理，同时成功或同时失败。为简化处理，将它们放在一个服务中。

资金持仓服务包含一系列具体的资金服务实现和持仓服务实现。资金持仓服务的接口，针对具体的资金或持仓服务，需要派发到各个子模块中做具体实现。不同的子模块对于同一个接口的实现可能是不同的。

需要完成的工作：

* 总体接口实现：
  - 子模块的管理和指令派发。
  - 查询指定投资服务对应的可用资金与持仓服务
* 各子模块的接口实现：
  - 资金转帐处理
  - 返回资金参数
  - 计算相关指标
  - 返回指定服务的相关指标信息
  - 盘后清算

#### 事务服务 routine-service

事务服务根据不同的类型有很大的差别。需要逐个单独设计规划。

待定。

#### 风控服务 risk-service

主要用于风控。

由投资服务触发启动。风控服务启动后向其他服务请求相关指标并进行风险判断。判断完成后向投资服务及前台推送风控结果，同时将风控结果保存备查。

需要完成的工作：

* 实现启动、停止风控接口
* 实现查询风控结果的接口
* 实现风控Lua脚本执行环境
* 实现风控Lua脚本的上传及管理
* 调用其他组件的接口获得相关指标
* 向前台风控结果

#### 行情服务 marketdata-service

行情服务分成公共行情服务和系统内行情服务两个部分。公共行情服务用于将行情源数据转换成系统内部格式，并向系统内行情服务提供订阅、推送和查询接口。

系统内行情服务接受系统内其他组件的订阅请求并将需要的行情、板块等数据发送给它们。

需要完成的工作：

* 公共行情服务：
  * 跟行情源（东财行情）的对接
  * 实现订阅、推送、查询接口
  * 身份认证
  * 传输数据的压缩和加密
* 系统内行情服务：
  * 跟公共行情服务的连接
  * 对系统内组件提供订阅和查询接口

#### 报盘服务 offer-service

报盘服务提供向柜台系统的交易通道。用于收取成交回报信息及发送委托。

报盘服务根据柜台系统的不同，可能会有不同的实现。各实现之间是独立的。

需要完成的工作：

* 跟柜台系统的对接
* 向系统推送成交回报
* 实现委托报单的接口

#### 认证授权服务 security-service

认证授权服务提供系统安全所需的身份认证及授权。该服务给出对应的授权信息。具体对于授权的使用，由其他各服务自身完成。

需要完成的工作：

* 用户安全信息与授权信息的管理。
* 身份验证。
* 权限信息的查询与使用

#### 时序服务 sequence-service

时序服务提供时间及序列相关的信息。目前它提供指标计算所需的序列号信息，以及清算所需的定时触发信号。

#### 网页界面 web-ui

web ui提供web前端界面展现。由web网关和前端两个部分组成。

##### web网关 web-gateway

web网关（web-gateway）用于向前端提供统一地址的API转发或重组，同时托管前端的静态资源。web网关还需要负责前端数据的推送。

##### web前台 web-frontend

前端（web-frontend）由html、js和CSS组成，提供用户交互界面。前端的数据都向web-gateway请求，由web-gateway根据需要向后台组件转发或进行数据重组。

需要完成的工作：

* 前端的界面设计、功能：
  * 用户登录
  * 资管公司
  * 基金产品
  * 投资指令
  * ……
* web网关对后台组件接口的转发
* web网关自有接口的实现
* web网关推送功能的实现

#### 移动端界面 mobile-ui

移动客户端和网页界面是同等地位的两个组件，具体内容待今后补充。

##### 移动端网关 mobile-gateway

##### android客户端 android-front

##### ios客户端 ios-front

### 基础设施

#### 系统编排工具

系统编排工具处理全系统所有组件的运行、依赖、扩展、健康检查等功能。需要考虑集中管理多客户系统的情况，以及客户服务器资源有限的情况。

#### 持续集成工具

持续集成工具负责处理开发时代码管理、编译、测试、发布、部署等一系列工作流程的自动化和标准化。需要完成工具的部署、流程设计及流程实现。

#### 日志、监控、度量、分布式调用跟踪工具

这些工具负责监控系统运行时状况并在出问题时帮助排查。需要完成工具的部署。需要考虑集成管理多客户系统的情况。

### 框架

#### 指标计算

指标计算框架参考并基于Kafka streams框架实现，提供了流式计算指标的能力。目前已经实现了基本的计算功能。未来要完善该框架在高可用性方面的功能。
